<div class="modal-overlay" (click)="fechar()">
  <div class="modal-content-slim" (click)="$event.stopPropagation()">
    <div class="modal-header-slim">
      <h4 class="modal-title-slim">Categorias de {{ tarefa.titulo }}</h4>
      <button class="close-btn" (click)="fechar()">✕</button>
    </div>

    <div class="modal-body-slim">
      <div class="categories-section">
        <label class="section-label">Disponíveis</label>
        <div cdkDropList id="disponiveis" #availableList="cdkDropList" [cdkDropListData]="categoriasParaAdicionar"
          [cdkDropListSortingDisabled]="true" [cdkDropListConnectedTo]="[selectedList]"
          (cdkDropListDropped)="drop($event)" class="drop-zone available-zone">

          <span *ngFor="let cat of categoriasParaAdicionar" cdkDrag class="category-badge text-white"
            [style.backgroundColor]="getCategoryColor(cat)">
            {{ cat }}
          </span>

          <p *ngIf="categoriasParaAdicionar.length === 0" class="empty-state">
            Tudo adicionado!
          </p>
        </div>
      </div>

      <div class="categories-section">
        <div class="section-header">
          <label class="section-label">Selecionadas</label>
          <span class="section-count">{{ categoriasDoItem.length }}/3</span>
        </div>

        <div cdkDropList id="selecionadas" #selectedList="cdkDropList" [cdkDropListData]="categoriasDoItem"
          [cdkDropListConnectedTo]="[availableList]" (cdkDropListDropped)="drop($event)"
          class="drop-zone selected-zone">

          <span *ngFor="let cat of categoriasDoItem; let i = index" cdkDrag
            class="category-badge text-white"
            [style.backgroundColor]="getCategoryColor(cat)">
            <span class="badge-label">{{ cat }}</span>
            <button class="badge-remove"
              (click)="categoriasDoItem.splice(i, 1); atualizarCategorias(); $event.stopPropagation()" title="Remover">
              ✕
            </button>
          </span>

          <p *ngIf="categoriasDoItem.length === 0" class="empty-state">
            Arraste categorias para cá
          </p>
        </div>
      </div>

      <div class="help-text">
        Arraste categorias entre as áreas. Máximo 3 por tarefa.
      </div>
    </div>

    <div class="modal-footer-slim">
      <button class="btn-cancel" (click)="fechar()">Cancelar</button>
      <button class="btn-save" [disabled]="categoriasDoItem.length === 0" (click)="salvar()">Salvar</button>
    </div>
  </div>
</div>