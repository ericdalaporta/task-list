<!-- Superposição do modal que fecha ao clicar fora do conteúdo -->
<div class="superposicao-modal" (click)="fechar()">
  <!-- Conteúdo do modal (não fecha ao clicar dentro) -->
  <div class="conteudo-modal" (click)="$event.stopPropagation()">
    <!-- Cabeçalho do modal com título e botão de fechar -->
    <div class="cabecalho-modal">
      <h4>Categorias de {{ tarefa.titulo }}</h4>
      <button class="botao-fechar" (click)="fechar()">✕</button>
    </div>

    <!-- Corpo do modal com listas de arraste -->
    <div class="corpo-modal">
      <!-- Seção de categorias disponíveis -->
      <div class="secao-categorias">
        <label class="rotulo-secao">Disponíveis</label>
        <!-- Container de categorias disponíveis (drag source) -->
        <div cdkDropList id="disponiveis" #listaDisponivel="cdkDropList" [cdkDropListData]="categoriasParaAdicionar"
          [cdkDropListSortingDisabled]="true" [cdkDropListConnectedTo]="[listaAtribuida]"
          (cdkDropListDropped)="aoSoltarCategoria($event)" class="zona-soltura">

          <!-- Cada categoria disponível pode ser arrastada -->
          <span *ngFor="let cat of categoriasParaAdicionar" cdkDrag class="badge-categoria text-white"
            [style.backgroundColor]="obterCorCategoria(cat)">
            {{ cat }}
          </span>

          <!-- Mensagem quando não há categorias disponíveis -->
          <p *ngIf="categoriasParaAdicionar.length === 0" class="estado-vazio">
            Tudo adicionado!
          </p>
        </div>
      </div>

      <!-- Seção de categorias selecionadas (atribuídas à tarefa) -->
      <div class="secao-categorias">
        <!-- Cabeçalho com label e contador de categorias -->
        <div class="cabecalho-secao">
          <label class="rotulo-secao">Selecionadas</label>
          <span class="contador-secao">{{ categoriasAtribuidasATarefa.length }}/{{ 3 }}</span>
        </div>

        <!-- Container de categorias selecionadas (drag target) -->
        <div cdkDropList id="selecionadas" #listaAtribuida="cdkDropList" [cdkDropListData]="categoriasAtribuidasATarefa"
          [cdkDropListConnectedTo]="[listaDisponivel]" (cdkDropListDropped)="aoSoltarCategoria($event)"
          class="zona-soltura">

          <!-- Cada categoria atribuída pode ser removida ou reordenada -->
          <span *ngFor="let cat of categoriasAtribuidasATarefa; let i = index" cdkDrag
            class="badge-categoria text-white"
            [style.backgroundColor]="obterCorCategoria(cat)">
            <span class="rotulo-badge">{{ cat }}</span>
            <!-- Botão para remover a categoria -->
            <button class="botao-remover-badge"
              (click)="categoriasAtribuidasATarefa.splice(i, 1); atualizarCategoriasDisponiveis(); $event.stopPropagation()" title="Remover">
              ✕
            </button>
          </span>

          <!-- Mensagem quando não há categorias atribuídas -->
          <p *ngIf="categoriasAtribuidasATarefa.length === 0" class="estado-vazio">
            Arraste categorias para cá
          </p>
        </div>
      </div>

      <!-- Texto de ajuda explicando como usar o modal -->
      <div class="texto-ajuda">
        Arraste categorias entre as áreas. Máximo 3 por tarefa.
      </div>
    </div>

    <!-- Rodapé do modal com botões de ação -->
    <div class="rodape-modal">
      <!-- Botão cancelar (fecha sem salvar) -->
      <button class="botao-cancelar" (click)="fechar()">Cancelar</button>
      <!-- Botão salvar (desabilitado se não houver categorias selecionadas) -->
      <button class="botao-salvar" [disabled]="categoriasAtribuidasATarefa.length === 0" (click)="salvar()">Salvar</button>
    </div>
  </div>
</div>