<div class="card-tarefa p-3 border rounded" [ngClass]="{'tarefa-completa': tarefa.completa}" cdkDragHandle style="cursor: grab;">
  <!-- LINHA PRINCIPAL: checkbox, título e ações -->
  <div class="linha-principal">
    <!-- SEÇÃO: Checkbox e Título -->
    <div class="secao-checkbox-titulo">
      <!-- Checkbox para marcar/desmarcar tarefa como completa -->
      <div class="form-check">
        <input 
          class="form-check-input checkbox-tarefa" 
          type="checkbox" 
          [checked]="tarefa.completa"
          (change)="alternarConclusao()"
          [id]="'checkbox-' + tarefa.id"
        >
        <label class="form-check-label" [for]="'checkbox-' + tarefa.id"></label>
      </div>

      <!-- Exibição ou edição do título -->
      <div class="container-titulo">
        <!-- MODO VISUALIZAÇÃO: Mostra o título normalmente -->
        <div *ngIf="!estaEmModoEdicao" [ngClass]="{'titulo-riscado': tarefa.completa}">
          <h5 class="titulo-texto">{{ tarefa.titulo }}</h5>
        </div>

        <!-- MODO EDIÇÃO: Mostra input e botões Salvar/Cancelar -->
        <div *ngIf="estaEmModoEdicao">
          <div class="linha-edicao">
            <!-- Input para digitar novo título -->
            <input 
              type="text" 
              class="input-edicao" 
              [(ngModel)]="tituloTemporario"
              (keyup.enter)="salvarEdicaoTitulo()"
              (keyup.escape)="cancelarEdicaoTitulo()"
              placeholder="Editar título"
            >
            <!-- Botão Salvar -->
            <button class="botao-salvar" (click)="salvarEdicaoTitulo()">Salvar</button>
            <!-- Botão Cancelar -->
            <button class="botao-cancelar" (click)="cancelarEdicaoTitulo()">Cancelar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- SEÇÃO: Ações (editar, categorias, deletar) -->
    <div class="secao-acoes">
      <!-- Ícone: Definir prazo -->
      <i class="bi bi-clock icone-acao" (click)="abrirModalPrazo()" title="Definir prazo"></i>
      <!-- Ícone: Editar título -->
      <i class="bi bi-pen icone-acao" (click)="iniciarEdicaoTitulo()" title="Editar título"></i>
      <!-- Ícone: Editar categorias -->
      <i class="bi bi-tag icone-acao" (click)="abrirModalEditarCategorias()" title="Editar categorias"></i>
      <!-- Ícone: Deletar tarefa -->
      <i class="bi bi-trash icone-acao" (click)="remover()" title="Deletar tarefa"></i>
    </div>
  </div>

  <!-- LINHA SECUNDÁRIA: Badges (prazo e categorias) -->
  <div class="container-badges">
    <!-- Badge de Prazo (se definido) -->
    <span *ngIf="tarefa.prazo" class="badge badge-prazo rounded-pill text-white" style="margin-right: 0.5rem;">
      <i class="bi bi-clock" style="margin-right: 0.3rem;"></i>Válido até {{ tarefa.prazo.data | date: 'dd/MM' }} {{ tarefa.prazo.hora }}
    </span>

    <!-- Badges de Categorias -->
    <span *ngFor="let categoria of tarefa.categorias"
          class="badge rounded-pill text-white"
          [ngClass]="obterClasseBadgeCategoria(categoria)">
      {{ categoria }}
    </span>
  </div>

  <!-- Modal para editar prazo -->
  <app-modal-prazo
    *ngIf="modalPrazoVisivel"
    [tarefa]="tarefa"
    (aoSalvar)="salvarPrazo($event)"
    (aoLimpar)="removerPrazo()"
    (aoFechar)="fecharModalPrazo()">
  </app-modal-prazo>
</div>
